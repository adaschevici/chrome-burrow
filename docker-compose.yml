name: chrome-cdp
services:
  chrome-headless:
    build:
      context: ./headless
      dockerfile: Dockerfile.${DISTRO:-debian}
      args:
        STEALTH: ${STEALTH:-basic}
    image: chrome-cdp:${MODE:-headless}-stealth-${STEALTH:-basic}
    container_name: chrome-${MODE:-headless}-stealth-${STEALTH:-basic}
    networks: [cdpnet]
    ports:
      - "${CDP_HOST_PORT}:${SOCAT_PORT}"
    shm_size: "${HEADLESS_SHM_SIZE}"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-fsS", "http://0.0.0.0:${SOCAT_PORT}/json/version"]
      interval: 10s
      timeout: 3s
      retries: 5
      start_period: 10s

  chrome-gui:
    build:
      context: ./gui
      dockerfile: Dockerfile.${DISTRO:-debian}
      args:
        STEALTH: ${STEALTH:-basic}
    image: chrome-cdp:${MODE:-headless}-stealth-${STEALTH:-basic}
    container_name: chrome-${MODE:-gui}-stealth-${STEALTH:-basic}
    networks: [cdpnet]
    ports:
      - "${CDP_HOST_PORT}:${SOCAT_PORT}"
      - "${VNC_PORT}:5900"
      - "${NOVNC_PORT}:6080"
    shm_size: "${GUI_SHM_SIZE}"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-fsS", "http://0.0.0.0:${SOCAT_PORT}/json/version"]
      interval: 10s
      timeout: 3s
      retries: 5
      start_period: 15s

networks:
  cdpnet:
    driver: bridge
